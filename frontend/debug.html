<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®è°ƒè¯• - è®°è´¦æœ¬</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ•°æ®è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-section">
        <h3>1. æœ¬åœ°å­˜å‚¨çŠ¶æ€</h3>
        <button onclick="checkLocalStorage()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨</button>
        <div id="localStorageInfo"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. API è¿æ¥æµ‹è¯•</h3>
        <button onclick="testAPI()">æµ‹è¯•APIè¿æ¥</button>
        <div id="apiInfo"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. æ•°æ®æ“ä½œæµ‹è¯•</h3>
        <button onclick="addTestRecord()">æ·»åŠ æµ‹è¯•è®°å½•</button>
        <button onclick="loadAllRecords()">åŠ è½½æ‰€æœ‰è®°å½•</button>
        <div id="dataInfo"></div>
    </div>

    <script src="api.js"></script>
    <script>
        function checkLocalStorage() {
            const token = localStorage.getItem('authToken');
            const user = localStorage.getItem('user');
            
            document.getElementById('localStorageInfo').innerHTML = `
                <pre>
Token: ${token ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}
User: ${user ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}
User Data: ${user || 'æ— '}
                </pre>
            `;
        }

        async function testAPI() {
            try {
                const response = await fetch('http://localhost:5000/health');
                const data = await response.json();
                document.getElementById('apiInfo').innerHTML = `
                    <pre>âœ… APIè¿æ¥æ­£å¸¸\n${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('apiInfo').innerHTML = `
                    <pre>âŒ APIè¿æ¥å¤±è´¥: ${error.message}</pre>
                `;
            }
        }

        async function addTestRecord() {
            try {
                const record = {
                    type: 'expense',
                    amount: 50,
                    category: 'food',
                    account: 'cash',
                    date: new Date().toISOString().split('T')[0],
                    note: 'æµ‹è¯•è®°å½•'
                };
                
                const result = await window.financeAPI.createRecord(record);
                document.getElementById('dataInfo').innerHTML = `
                    <pre>âœ… æ·»åŠ æµ‹è¯•è®°å½•æˆåŠŸ\n${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('dataInfo').innerHTML = `
                    <pre>âŒ æ·»åŠ å¤±è´¥: ${error.message}</pre>
                `;
            }
        }

        async function loadAllRecords() {
            try {
                const result = await window.financeAPI.getRecords();
                document.getElementById('dataInfo').innerHTML = `
                    <pre>âœ… åŠ è½½è®°å½•æˆåŠŸ\nè®°å½•æ•°é‡: ${result.data.records.length}\n${JSON.stringify(result.data.records, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('dataInfo').innerHTML = `
                    <pre>âŒ åŠ è½½å¤±è´¥: ${error.message}</pre>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        checkLocalStorage();
        testAPI();
    </script>
</body>
</html>